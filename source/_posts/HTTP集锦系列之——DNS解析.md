---
title: HTTP集锦系列之——DNS解析
date: 2019-03-06 15:17:40
tags: [http, dns]
categories: [frontend, backend]
---

费尽心思的买了云服务器, 又氪金买了喜欢的域名, 但是很烦, 域名又需要解析, 那么这个过程是怎样的呢?


<!-- more -->


## 更新

------

### [2019-3-25]

#### Added

- 新增`DNS解析过程`图解

#### Changed

- 重构`解析过程`条目

### [2019-6-18]

#### Added

- 新增`Q&A`区块
  - 新增`递归`查询和`迭代`查询的区别
  - 新增什么情况下会使用`迭代`查询

#### Changed

- 更新`过程`区块
  - `转发模式`应该改为`检查是否支持递归查询`

### [2019-6-22]

#### Added

- `Q&A`区块下新增`什么是域名劫持?`

### [2020-11-9]

#### Changed

- 更新域名解析的过程细节

## 记录

------

### 缘由

> DNS - 域名系统

网络通讯基于`TCP/IP`协议簇, 而`TCP/IP`又是基于`IP`地址, 计算机在网络通信中只能识别`IPv4`、`IPv6`等类型的地址, `DNS`解析就是将域名解析成了相应的IP地址

### 图解

![DNS解析过程](https://oos.blog.yyge.top/2019/3/6/HTTP%E9%9B%86%E9%94%A6%E7%B3%BB%E5%88%97%E4%B9%8B%E2%80%94%E2%80%94DNS%E8%A7%A3%E6%9E%90/images/1.jpg?imageView2/0/q/75|watermark/2/text/6Ziz5ZOl5bCP56uZ/font/5b6u6L2v6ZuF6buR/fontsize/440/fill/IzE4OTBGRg==/dissolve/100/gravity/SouthEast/dx/10/dy/10|imageslim)

### 过程

> 图不好画, 所以使用文字总结

- 提取url中的域名信息
- 检查浏览器缓存
- 检查操作系统缓存的`Hosts`文件
- 检查路由器缓存
- 检查运营商提供的本地DNS服务器(`localDNS`)缓存, 不具有权威性
- 检查是否在`本地区域配置文件`中, 返回解析结果, 具有权威性
- localDNS 判断是否转发模式
  - 转发模式: 将域名解析权交给 `CNAME` 指向的 `CDN` 的 `DNS` 负载均衡系统, CDN 解析完成之后, 会将 IP 地址返回给 localDNS
  - 非转发模式: 进行下一步
- 本地DNS服务器(检查是否支持`递归`查询)
  - 支持
    - 依次寻找上一级DNS服务器解析
  - 不支持
    - 本地DNS发送请求到根DNS
    - 根DNS返回`顶级域名服务器`(.com、.top、...)地址
    - 本地DNS联系该`顶级域名服务器`来具体子级域名(xx.com、xxx.xx.com)
- 本地DNS服务器接收到IP地址
  - 写入缓存
- 返回给客户端

### 域名劫持

上述[解析过程](#过程)中由于`DNS`解析记录可能存储在用户本机, 所以可能导致`域名劫持`

## Q&A

> **Q**: `递归`查询和`迭代`查询的区别?

***A***: **递归查询**指的是服务器`一条龙`服务, 客户端将解析域名的请求发送给`localDNS`, 如果`localDNS`检查缓存后无法解析的话, 会将解析请求发送给`rootDNS`, `rootDNS`无法解析则继续发给`顶级域名服务器`...后续同理, 如果某个DNS服务器成功解析, 则会将解析后的结构反向传送给上一级, 最终返回给`localDNS`. 而**迭代查询**则指的是, `rootDNS`请求`rootDNS`, `rootDNS`返回一个可以解析的DNS服务器, 你自己去请求, 这种方式比较耗内存, 所以一般默认采用的是`递归`查询.

> **Q**: 什么情况下会使用`迭代`查询?

***A***: 两种情况. ①: DNS服务器配置为不支持`递归`查询; ②: 客户端DNS请求的`递归标志位`为0.

> **Q**: 什么是`域名劫持`?

***A***: 由于DNS可能将解析记录缓存到操作系统的`hosts`文件中, 这就表明可以随意修改IP地址, 进而使域名解析到非法地址.

## 参考

------

- [DNS解析的过程是什么, 求详细的?](https://www.zhihu.com/question/23042131)
- [DNS域名解析过程](https://blog.csdn.net/zhangyuan19880606/article/details/51141610)